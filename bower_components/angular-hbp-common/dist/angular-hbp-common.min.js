angular.module("hbpCommon",["ui.bootstrap","ui.router","bbpConfig","bbpOidcClient","hbp-common-templates"]),window.hbpCommonVersion="0.4.2",angular.module("hbpCommon").controller("hbpMetaNavigationCtrl",["$rootScope","$scope","$state","hbpUserDirectory","bbpOidcSession",function(a,b,c,d,e){"use strict";d.getCurrentUser().then(function(a){b.currentUser=a}),b.logout=function(){e.logout().then(function(){a.$broadcast("user:disconnected"),b.currentUser=null})}}]),angular.module("hbpCommon").directive("hbpBreadcrumb",["$state",function(a){"use strict";return{restrict:"E",templateUrl:"templates/breadcrumb.html",scope:{items:"="},link:function(b){var c=function(b,c){return a.href(b,c)},d=function(){b.parentItems=b.items&&b.items.slice(0,b.items.length-1),b.currentItem=b.items&&b.items[b.items.length-1]},e=function(){b.$watch("items",d),b.urlForState=c,d()};e()}}}]),angular.module("hbpCommon").directive("hbpContentDescription",function(){"use strict";return{templateUrl:"templates/content-description.html",restrict:"E",scope:{content:"=?"},link:function(a){if(a.content){var b=a.content.split("/");a.fallback=b.length>1?b[1]:b[0]}}}}),angular.module("hbpCommon").directive("hbpContentIcon",function(){"use strict";return{templateUrl:"templates/content-icon.html",restrict:"E",scope:{content:"=?"}}}),angular.module("hbpCommon").directive("hbpIcon",function(){"use strict";return{templateUrl:"templates/icon.html",restrict:"E",scope:{entity:"=?",type:"=?"},link:function(a){!a.type&&a.entity&&(a.type=a.entity._entityType)}}}),angular.module("hbpCommon").directive("hbpPerformAction",[function(){"use strict";return{restrict:"A",scope:{action:"&hbpPerformAction"},link:function(a,b,c){var d=!1,e=function(){b.html(a.text),b.attr("disabled",!1),d=!1},f=function(){d=!0,a.loadingMessage&&b.html(a.loadingMessage),b.attr("disabled",!0),a.action().then(e,e)};a.loadingMessage=c.hbpLoadingMessage,a.text=a.text||b.html(),b.on("click",f)}}}]),angular.module("hbpCommon").factory("hbpDialogFactory",["$modal","$log","$q","$rootScope","$compile","$templateCache","hbpErrorService",function(a,b,c,d,e,f,g){"use strict";function h(b){b=_.extend({scope:d,title:"Confirm",confirmLabel:"Yes",cancelLabel:"No",template:"Are you sure?"},b);var c=b.scope.$new();c.title=b.title,c.confirmLabel=b.confirmLabel,c.cancelLabel=b.cancelLabel,c.confirmationContent=b.template,c.confirmationContentUrl=b.templateUrl;var e=a.open({templateUrl:"templates/dialog-confirmation.html",show:!0,backdrop:"static",scope:c});return e.result}function i(a){var b=d.$new();return b.error=a,j({"class":"error",title:"Error!",label:"Close",scope:b,templateUrl:"templates/error-alert.html"})}function j(b){if("string"==typeof b)return k.apply(window,arguments);b=_.extend({scope:d,title:"Message",label:"Close","class":"default"},b);var c=b.scope.$new();c.title=b.title,c.label=b.label,c.alertContentUrl=b.templateUrl,c.alertContent=b.template,c.htmlClass=b.class;var e=a.open({templateUrl:"templates/dialog-alert.html",show:!0,backdrop:"static",scope:c});return e.result}function k(a,c,d){return b.warn("hbpDialogFactory.alert(templateUrl, title, scope) is deprecated."),b.log("Use hbpDialogFactory.alert(options) instead"),j({templateUrl:a,title:c,scope:d})}return{alert:j,error:i,confirm:h,confirmation:function(a,d,e,f,i){return b.warn("hbpDialogFactory.confirmation is deprecated."),b.log("Use hbpDialogFactory.confirm instead"),h({scope:i,title:e,confirmLabel:f,cancelLabel:"cancel",templateUrl:a}).then(function(){return d?d(i).then(null,function(a){var b;return"string"==typeof a?b=g.error({type:"Error",message:a}):a?(a.status||(a={status:-1,data:a}),b=g.httpError(a)):b=g.error(),j({title:"Error","class":"alert-danger",template:b.message}),c.reject(b)}):void 0})}}}]),angular.module("hbpCommon").service("hbpErrorService",function(){"use strict";var a=function(a){a=angular.extend({type:"UnknownError",message:"An unknown error occured.",code:-1},a),this.type=a.type,this.message=a.message,this.data=a.data,this.code=a.code};return{httpError:function(b){if(void 0===b.status)return new a({message:"Cannot parse error, invalid format."});var c=new a({code:b.status});if(0===b.status)return c.type="ClientError",c.message="The client cannot run the request.",c;if(404===b.status)return c.type="NotFound",c.message="Resource not found",c;if(b.data){var d=b.data;d.error&&(d=d.error),d.type&&(c.type=d.type),d.data&&(c.data=d.data),d.message?c.message=d.message:d.reason&&(c.type="Error",c.message=d.reason)}return c},error:function(b){return new a(b)}}}),angular.module("hbpCommon").service("hbpUiUtil",["$window","$document","$q","hbpErrorService",function(a,b,c,d){"use strict";function e(c){c.find&&(c=c[0]);var d=c.getBoundingClientRect();return d.top>=0&&d.left>=0&&d.bottom<=(a.innerHeight||b.documentElement.clientHeight)&&d.right<=(a.innerWidth||b.documentElement.clientWidth)}var f=function(a,b){return function(e){var f=Array.prototype.slice.call(arguments);return f.shift(),a.apply(this,f).then(function(a){e(a)},function(a){b.error=d.httpError(a),c.reject(b.error)})}};return{isInViewport:e,dialogSubmissionRestCallErrorHandler:f}}]).filter("hbpDatetime",["$filter",function(a){"use strict";return function(b){return a("date")(b,"yyyy-MM-dd HH:mm:ss")}}]).filter("hbpCapitalize",["$filter",function(){"use strict";return function(a){return a.charAt().toUpperCase()+a.substring(1)}}]).run(["$rootScope","$log","$state","$stateParams","$location","$window",function(a,b,c,d,e,f){"use strict";var g=0;a.$on("$stateChangeSuccess",function(a,b,c,d){d&&d.name&&!e.$$replace&&g++}),a.goToPrevious=function(a,d){g>0?(g--,f.history.go(-1)):a?c.go(a,d):b.error("no previous state, cannot navigate back.")}}]),angular.module("hbpCommon").factory("hbpUserDirectory",["$rootScope","$q","$http","$cacheFactory","bbpConfig","hbpErrorService",function(a,b,c,d,e,f){"use strict";var g=d("hbpUserCache"),h=e.get("api.user.v0"),i="_currentUser_";a.$on("user:disconnected",function(){g.removeAll()});var j=function(a,b,c){if(a.length>0){for(var d=b+a[0],e=1;e<a.length;e++)d.length+a[e].length+1<2e3?d+="%2B"+a[e]:(c.push(d),d=b+a[e]);c.push(d)}},k=function(a,b){for(var c=0;c<a.length;c++)void 0===a[c].displayName&&(a[c].displayName=a[c].name),b[a[c].id]=a[c],g.put(a[c].id,a[c])},l=function(a){return function(){return c.get(a).then(m,function(a){return b.reject(f.httpError(a))})}},m=function(a){var b=a.data.result,c={result:b};return a.data.next&&(c.next=l(a.data.next)),a.data.prev&&(c.prev=l(a.data.prev)),c};return{get:function(a){var d,e=b.defer(),f=function(){e.reject.apply(e,a)},i=function(a){return o.length>0?(k(a.data.result,n),c.get(o.shift()).then(i,f)):(k(a.data.result,n),void e.resolve(n))},l=[],m=[],n={},o=[];for(d=0;d<a.length;d++){var p=g.get(a[d]);p?n[a[d]]=p:0===a[d].indexOf("S")?m.push(a[d]):l.push(a[d])}return l.length+m.length===0?e.resolve(n):(j(l,h+"/user?filter=id=",o),j(m,h+"/group?filter=id=",o),c.get(o.shift()).then(i,f)),e.promise},getCurrentUser:function(){var a=b.defer(),d=g.get(i);return d?a.resolve(d):b.all({user:c.get(h+"/user/me"),groups:c.get(h+"/user/me/groups")}).then(function(b){var c=b.user.data;c.groups=b.groups.data.result,g.put(i,c),a.resolve(c)},a.reject),a.promise},create:function(a){return c.post(h+"/user",a)},list:function(a){var d,e={page:0,pageSize:10,managedOnly:!1},g=angular.extend(e,a);if(g.filter){var i=_.map(g.filter,function(a,b){return _.isArray(a)&&(a=a.join("+")),b+"="+a});d=i.join()}var j;g.sort&&(j=_.isArray(g.sort)?g.sort.join():_(g.sort).toString());var k=h+"/user";return g.managedOnly&&(k+="/managed"),c.get(k,{params:{page:g.page,pageSize:g.pageSize,filter:d,sort:j}}).then(m,function(a){return b.reject(f.httpError(a))})}}}]),angular.module("hbpCommon").service("hbpUtil",function(){"use strict";return{format:function(a,b){return angular.isArray(b)||(b=[b]),a.replace(/{(\d+)}/g,function(a,c){return"undefined"!=typeof b[c]?b[c]:a})}}}),angular.module("hbpCommon").config(["$httpProvider",function(a){"use strict";window.XMLHttpRequest=function(a){return function(){var b=new a;return b.setRequestHeader=function(a){return function(c,d){"HBP-AngularProgressEventMixin"===c?d.call(b,b):a.apply(this,arguments)}}(b.setRequestHeader),b}}(window.XMLHttpRequest),a.interceptors.push("hbpXhrProgressEventInterceptor")}]).factory("hbpXhrProgressEventInterceptor",function(){"use strict";return{request:function(a){return(a.uploadProgress||a.progress)&&(a.headers["HBP-AngularProgressEventMixin"]=function(b){a.uploadProgress&&b.upload.addEventListener("progress",a.uploadProgress,!1),a.progress&&b.addEventListener("progress",a.progress,!1)}),a}}}),angular.module("hbp-common-templates",["templates/breadcrumb.html","templates/content-description.html","templates/content-icon.html","templates/dialog-alert.html","templates/dialog-confirmation.html","templates/error-alert.html","templates/icon.html"]),angular.module("templates/breadcrumb.html",[]).run(["$templateCache",function(a){a.put("templates/breadcrumb.html",'<ol class="breadcrumb">\n    <li ng-repeat="item in parentItems"\n        ><a ng-href="{{urlForState(item.state, item.stateParams)}}"\n            ><hbp-icon type="item.type"></hbp-icon>\n            <span class="breadcrumb-item-name {{item.class}}">{{item.name}}</span\n        ></a\n    ></li\n    ><li\n        ><hbp-icon type="currentItem.type"></hbp-icon>\n        <span class="breadcrumb-item-name {{currentItem.class}}">{{currentItem.name}}</span\n    ></li>\n</ol>\n')}]),angular.module("templates/content-description.html",[]).run(["$templateCache",function(a){a.put("templates/content-description.html",'<span ng-switch="content">\n    <span ng-switch-when="application/vnd.bbp.FeatureExtract.Dependency+txt">Text FeatureExtract</span>\n    <span ng-switch-when="application/vnd.bbp.SimulationProtocol.StimulationConfig">Simulation Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.SimulationProtocol.ReportingConfig">Reporting Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Config+config">Circuit Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Config">Circuit Configuration</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Combination">Circuit Combination</span>\n    <span ng-switch-when="application/vnd.bbp.Circuit.Combination+xml">XML Circuit Combination</span>\n    <span ng-switch-when="application/vnd.bbp.Simulation.BlueConfig">BlueConfig File</span>\n    <span ng-switch-when="application/vnd.bbp.Simulation.HOC">HOC Simulation</span>\n    <span ng-switch-when="application/vnd.bbp.bundle.Image.png">Image Bundle</span>\n    <span ng-switch-when="application/zip">Archive</span>\n    <span ng-switch-when="application/rar">Archive</span>\n    <span ng-switch-when="application/json">JSON</span>\n    <span ng-switch-when="application/txt">Plain Text</span>\n    <span ng-switch-when="text/plain">Plain Text</span>\n    <span ng-switch-when="image/jpeg">JPEG Image</span>\n    <span ng-switch-when="image/png">PNG Image</span>\n    <span ng-switch-when="image/gif">GIF Image</span>\n    <span ng-switch-when="video/avi">AVI Video</span>\n    <span ng-switch-when="video/mpg">MPEG Video</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.Morphology">Morphology</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.Morphology+asc">ASCI Morphology</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.Morphology+h5">H5 Morphology</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.NeuronDB">DAT NeuronDB</span>\n    <span ng-switch-when="model/vnd.bbp.Morphology.NeuronDB+dat">DAT NeuronDB</span>\n    <span ng-switch-default>{{fallback}}</span>\n</span>\n')}]),angular.module("templates/content-icon.html",[]).run(["$templateCache",function(a){a.put("templates/content-icon.html",'<span class="bbp-browser-entity-icon" ng-switch="content">\n    <i ng-switch-when="application/zip" class="fa fa-file-archive-o"></i>\n    <i ng-switch-when="application/rar" class="fa fa-file-archive-o"></i>\n    <i ng-switch-when="application/txt" class="fa fa-file-text-o"></i>\n    <i ng-switch-when="text/plain" class="fa fa-file-text-o"></i>\n    <i ng-switch-when="application/pdf" class="fa fa-file-pdf-o"></i>\n    <i ng-switch-when="image/jpeg" class="fa fa-file-image-o"></i>\n    <i ng-switch-when="image/png" class="fa fa-file-image-o"></i>\n    <i ng-switch-when="image/gif" class="fa fa-file-image-o"></i>\n    <i ng-switch-when="application/json" class="fa fa-file-code-o"></i>\n    <i ng-switch-when="video/avi" class="fa fa-file-video-o"></i>\n    <i ng-switch-when="video/mpeg" class="fa fa-file-video-o"></i>\n    <i ng-switch-default class="fa fa-file-o"></i>\n</span>\n')}]),angular.module("templates/dialog-alert.html",[]).run(["$templateCache",function(a){a.put("templates/dialog-alert.html",'<div class="modal-header"  >\n    <button type="button" class="close" ng-click="$close()" aria-hidden="true">&times;</button>\n    <h4 class="modal-title">{{title}}</h4>\n</div>\n<div class="modal-body {{htmlClass}}">\n    <ng-include src="alertContentUrl"></ng-include>\n    {{alertContent}}\n</div>\n<div class="modal-footer">\n    <button class="btn btn-default" ng-click="$close()">{{label}}</button>\n</div>\n')}]),angular.module("templates/dialog-confirmation.html",[]).run(["$templateCache",function(a){a.put("templates/dialog-confirmation.html",'<div class="modal-header"  >\n    <button type="button" class="close" ng-click="$dismiss(\'cancel\')" aria-hidden="true">&times;</button>\n    <h4 class="modal-title">{{title}}</h4>\n</div>\n<div class="modal-body">\n    <alert ng-if="error" type="danger">{{error.reason}}</alert>\n    <ng-include ng-if="confirmationContentUrl" src="confirmationContentUrl"></ng-include>\n    {{confirmationContent}}\n</div>\n<div class="modal-footer">\n    <button class="btn btn-default" ng-click="$dismiss(\'cancel\')">{{cancelLabel}}</button>\n    <button class="btn btn-danger" ng-click="$close()">{{confirmLabel}}</button>\n</div>\n')}]),angular.module("templates/error-alert.html",[]).run(["$templateCache",function(a){a.put("templates/error-alert.html",'<div class="alert alert-danger">[{{error.type}}] {{error.message}}</div>\n<pre><code>{{error | json}}</code></pre>\n')}]),angular.module("templates/icon.html",[]).run(["$templateCache",function(a){a.put("templates/icon.html",'<span class="bbp-browser-entity-icon" ng-switch="type">\n    <i ng-switch-when="root" class="glyphicon glyphicon-home"></i>\n    <i ng-switch-when="project" class="glyphicon glyphicon-hdd"></i>\n    <i ng-switch-when="folder" class="glyphicon glyphicon-folder-open"></i>\n    <i ng-switch-when="file" class="glyphicon glyphicon-file"></i>\n    <i ng-switch-when="release" class="glyphicon glyphicon-lock"></i>\n    <i ng-switch-when="link:folder" class="glyphicon glyphicon-link"></i>\n    <i ng-switch-when="link:file" class="glyphicon glyphicon-link"></i>\n    <i ng-switch-when="link:project" class="glyphicon glyphicon-link"></i>\n    <i ng-switch-when="link:release" class="glyphicon glyphicon-link"></i>\n</span>\n')}]);